<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ—¥æœŸå€’è®¡æ—¶</title>
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="å€’è®¡æ—¶">
  <!-- Android Chrome PWA ä¼˜åŒ– -->
  <meta name="mobile-web-app-capable" content="yes">
  <!-- Vant 4 CSS -->
  <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      min-height: 100vh;
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 20px;
    }

    .container {
      width: 100%;
      min-height: 100vh;
      padding: 10px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
    }

    .title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .label {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .result-card {
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      color: white;
      text-align: center;
      animation: fadeIn 0.5s ease;
    }

    .result-title {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .result-days {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .result-date {
      font-size: 14px;
      opacity: 0.9;
    }

    /* é¡µé¢åº•éƒ¨åœ°å€æ  */
    .page-footer {
      padding: 20px;
      text-align: center;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .page-url {
      font-size: 12px;
      color: #999;
      word-break: break-all;
      background: #f5f5f5;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .page-url-label {
      font-size: 11px;
      color: #bbb;
      margin-bottom: 5px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .vant-field {
      border-radius: 10px;
      overflow: hidden;
    }

    .vant-field .van-field__control {
      font-size: 24px;
      color: #5557d5;
      font-weight: 500;
    }

    .vant-field .van-field__control::placeholder {
      color: #999;
      font-size: 16px;
    }

    .install-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 15px 25px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      cursor: pointer;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    .install-button:active {
      transform: scale(0.95);
    }

    /* éšè—å®‰è£…æŒ‰é’® */
    .install-button.hidden {
      display: none;
    }

    /* iOS å®‰è£…å¼•å¯¼æ°”æ³¡ */
    .ios-install-guide {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .ios-install-guide.hidden {
      display: none;
    }

    .ios-guide-content {
      background: white;
      border-radius: 20px;
      padding: 30px 20px;
      max-width: 350px;
      text-align: center;
      animation: slideUp 0.3s ease;
    }

    .ios-guide-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    .ios-guide-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    .ios-guide-text {
      font-size: 15px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .ios-guide-steps {
      text-align: left;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .ios-guide-steps ol {
      margin: 0;
      padding-left: 20px;
      color: #555;
      line-height: 1.8;
    }

    .ios-guide-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 40px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    /* ç®­å¤´åŠ¨ç”» */
    .guide-arrow {
      position: absolute;
      bottom: 80px;
      right: 20px;
      font-size: 50px;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Android å®‰è£…æç¤ºå¡ç‰‡ */
    .android-install-card {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 320px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      z-index: 10001;
      text-align: center;
      animation: scaleIn 0.3s ease;
    }

    .android-install-card.hidden {
      display: none;
    }

    @keyframes scaleIn {
      from {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
      }
      to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .android-card-icon {
      font-size: 50px;
      margin-bottom: 15px;
    }

    .android-card-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }

    .android-card-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .android-card-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 30px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    .android-card-cancel {
      background: transparent;
      color: #999;
      border: none;
      padding: 10px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }

    /* é®ç½©å±‚ */
    .install-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
    }

    .install-overlay.hidden {
      display: none;
    }

  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <h1 class="title">ğŸ“… æ—¥æœŸå€’è®¡æ—¶</h1>

      <!-- é¡µé¢åº•éƒ¨åœ°å€æ  -->
      <div class="page-footer">
        <div class="page-url-label">å½“å‰é¡µé¢åœ°å€</div>
        <div class="page-url" id="pageUrl">åŠ è½½ä¸­...</div>
      </div>

      <div class="form-group">
        <span class="label" onclick="refreshPage()" style="cursor: pointer;" title="ç‚¹å‡»åˆ·æ–°é¡µé¢">é€‰æ‹©æ—¥æœŸ</span>
        <van-field
          v-model="selectedDate"
          readonly
          clickable
          placeholder="è¯·é€‰æ‹©æ—¥æœŸ"
          @click="openCalendar"
          class="vant-field"
        />
      </div>

      <div class="result-card" v-if="result !== null">
        <div class="result-title">è·ç¦» {{ resultDate }} è¿˜æœ‰</div>
        <div class="result-days">{{ result }} å¤©</div>
        <div class="result-date">ç›®æ ‡æ—¥æœŸ: {{ resultDate }}</div>
      </div>

      <!-- æ—¥å†å¼¹å‡ºå±‚ -->
      <van-calendar
        v-model:show="showCalendar"
        @confirm="onConfirm"
        :min-date="minDate"
        :max-date="maxDate"
        color="#764ba2"
      />
    </div>

    <!-- å®‰è£…æŒ‰é’® -->
    <button id="installButton" class="install-button hidden" onclick="installApp()">
      <span>ğŸ“²</span>
      <span>å®‰è£…åº”ç”¨</span>
    </button>

    <!-- iOS å®‰è£…å¼•å¯¼ -->
    <div id="iosInstallGuide" class="ios-install-guide hidden">
      <div class="ios-guide-content">
        <div class="ios-guide-icon">ğŸ“±</div>
        <div class="ios-guide-title">å®‰è£…åˆ°ä¸»å±å¹•</div>
        <div class="ios-guide-text">
          å°†æ­¤åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œè·å¾—åƒåŸç”Ÿåº”ç”¨ä¸€æ ·çš„ä½“éªŒï¼
        </div>
        <div class="ios-guide-steps">
          <ol>
            <li>ç‚¹å‡»å±å¹•åº•éƒ¨çš„<strong>åˆ†äº«æŒ‰é’®</strong> <span style="font-size: 20px;">â‹</span></li>
            <li>å‘ä¸‹æ»‘åŠ¨æ‰¾åˆ°<strong>"æ·»åŠ åˆ°ä¸»å±å¹•"</strong></li>
            <li>ç‚¹å‡»<strong>"æ·»åŠ "</strong>å®Œæˆå®‰è£…</li>
          </ol>
        </div>
        <button class="ios-guide-button" onclick="closeIOSGuide()">æˆ‘çŸ¥é“äº†</button>
      </div>
      <div class="guide-arrow">ğŸ‘‡</div>
    </div>

    <!-- Android å®‰è£…æç¤ºå¡ç‰‡ -->
    <div id="installOverlay" class="install-overlay hidden" onclick="closeAndroidCard()"></div>
    <div id="androidInstallCard" class="android-install-card hidden">
      <div class="android-card-icon">ğŸ‰</div>
      <div class="android-card-title">å®‰è£…æ­¤åº”ç”¨ï¼Ÿ</div>
      <div class="android-card-text">
        å°†"æ—¥æœŸå€’è®¡æ—¶"å®‰è£…åˆ°æ‚¨çš„è®¾å¤‡ï¼Œè·å¾—æ›´æµç•…çš„ä½¿ç”¨ä½“éªŒï¼
      </div>
      <button class="android-card-button" onclick="installApp()">ç«‹å³å®‰è£…</button>
      <button class="android-card-cancel" onclick="closeAndroidCard()">æš‚ä¸å®‰è£…</button>
    </div>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Vant 4 JS -->
  <script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>
  <!-- å†œå†è®¡ç®—åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.js"></script>

  <script>
    const { createApp, ref, computed, onMounted } = Vue;

    const app = createApp({
      setup() {
        const showCalendar = ref(false);
        const selectedDate = ref('');
        const result = ref(null);
        const resultDate = ref('');
        const minDate = ref(new Date(2020, 0, 1));
        const maxDate = ref(new Date(2030, 11, 31));

        // è®¡ç®—ä¸‹ä¸€ä¸ªå†œå†å¤§å¹´åˆä¸€
        const getNextLunarNewYear = () => {
          const today = new Date();
          const year = today.getFullYear();
          const month = today.getMonth() + 1;
          const day = today.getDate();

          // å†œå†æ–°å¹´æ—¥æœŸè¡¨ï¼ˆæŒ‰å¹´ä»½ï¼‰
          const lunarNewYearDates = {
            2025: { year: 2025, month: 1, day: 29 },  // 2025å¹´æ˜¥èŠ‚
            2026: { year: 2026, month: 2, day: 17 },  // 2026å¹´æ˜¥èŠ‚
            2027: { year: 2027, month: 2, day: 6 },   // 2027å¹´æ˜¥èŠ‚
            2028: { year: 2028, month: 1, day: 26 },  // 2028å¹´æ˜¥èŠ‚
            2029: { year: 2029, month: 2, day: 13 },  // 2029å¹´æ˜¥èŠ‚
            2030: { year: 2030, month: 2, day: 3 }    // 2030å¹´æ˜¥èŠ‚
          };

          // æ£€æŸ¥ä»Šå¹´çš„æ˜¥èŠ‚æ˜¯å¦å·²ç»è¿‡å»
          const thisYearSpringFestival = lunarNewYearDates[year];

          if (thisYearSpringFestival) {
            const springFestivalDate = new Date(
              thisYearSpringFestival.year,
              thisYearSpringFestival.month - 1,
              thisYearSpringFestival.day
            );

            // å¦‚æœä»Šå¹´çš„æ˜¥èŠ‚è¿˜æ²¡åˆ°ï¼Œè¿”å›ä»Šå¹´çš„æ˜¥èŠ‚
            if (today < springFestivalDate) {
              return thisYearSpringFestival;
            }
          }

          // ä»Šå¹´çš„æ˜¥èŠ‚å·²ç»è¿‡äº†ï¼Œè¿”å›æ˜å¹´çš„æ˜¥èŠ‚
          const nextYear = year + 1;
          if (lunarNewYearDates[nextYear]) {
            return lunarNewYearDates[nextYear];
          }

          // å¦‚æœæ²¡æœ‰é¢„å®šä¹‰ï¼Œä½¿ç”¨é»˜è®¤ä¼°ç®—ï¼ˆæ˜å¹´2æœˆä¸­æ—¬ï¼‰
          return { year: nextYear, month: 2, day: 15 };
        };

        // æ ¼å¼åŒ–æ—¥æœŸ
        const formatDate = (date) => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        };

        // ç¡®è®¤æ—¥æœŸé€‰æ‹©
        const onConfirm = (date) => {
          selectedDate.value = formatDate(date);
          showCalendar.value = false;
          // é€‰æ‹©æ—¥æœŸåè‡ªåŠ¨è®¡ç®—
          calculateDays();
        };

        // æ‰“å¼€æ—¥å†
        const openCalendar = () => {
          showCalendar.value = true;
        };

        // è®¡ç®—å‰©ä½™å¤©æ•°
        const calculateDays = () => {
          if (!selectedDate.value) {
            return;
          }

          const today = new Date();
          today.setHours(0, 0, 0, 0);

          const target = new Date(selectedDate.value);
          target.setHours(0, 0, 0, 0);

          const diffTime = target - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          result.value = diffDays;
          resultDate.value = selectedDate.value;
        };

        // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºæ˜å¹´å†œå†å¤§å¹´åˆä¸€
        onMounted(() => {
          const nextLunarNewYear = getNextLunarNewYear();
          const defaultDate = new Date(nextLunarNewYear.year, nextLunarNewYear.month - 1, nextLunarNewYear.day);
          selectedDate.value = formatDate(defaultDate);
          // é¡µé¢åŠ è½½åè‡ªåŠ¨è®¡ç®—
          calculateDays();
        });

        return {
          showCalendar,
          selectedDate,
          result,
          resultDate,
          minDate,
          maxDate,
          onConfirm,
          openCalendar,
        };
      }
    });

    // æ³¨å†Œ Vant ç»„ä»¶
    app.use(vant);

    // æŒ‚è½½åº”ç”¨
    app.mount('#app');

    // æ³¨å†Œ Service Worker (PWA)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ:', registration.scope);
          })
          .catch(error => {
            console.log('ServiceWorker æ³¨å†Œå¤±è´¥:', error);
          });
      });
    }

    // ========== æ™ºèƒ½å®‰è£…å¼•å¯¼ç³»ç»Ÿ ==========

    // æ£€æµ‹è®¾å¤‡ç±»å‹å’Œæ“ä½œç³»ç»Ÿ
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isAndroid = /Android/.test(navigator.userAgent);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

    // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡å¼•å¯¼ï¼ˆä½¿ç”¨ localStorageï¼‰
    const guideStorageKey = 'install_guide_shown';
    const hasShownGuide = localStorage.getItem(guideStorageKey);

    // å…³é—­å¼•å¯¼çš„å‡½æ•°
    window.closeIOSGuide = function() {
      document.getElementById('iosInstallGuide').classList.add('hidden');
      // æ ‡è®°å·²æ˜¾ç¤ºè¿‡ï¼Œé¿å…é¢‘ç¹æ‰“æ‰°
      localStorage.setItem(guideStorageKey, 'ios');
    };

    window.closeAndroidCard = function() {
      document.getElementById('androidInstallCard').classList.add('hidden');
      document.getElementById('installOverlay').classList.add('hidden');
      // æ ‡è®°å·²æ˜¾ç¤ºè¿‡
      localStorage.setItem(guideStorageKey, 'android');
    };

    // iOS å®‰è£…å¼•å¯¼é€»è¾‘
    if (isIOS && !isStandalone && !hasShownGuide) {
      // å»¶è¿Ÿ 3 ç§’æ˜¾ç¤ºå¼•å¯¼ï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°é¡µé¢å†…å®¹
      setTimeout(() => {
        document.getElementById('iosInstallGuide').classList.remove('hidden');
      }, 3000);
    }

    // PWA å®‰è£…æç¤ºé€»è¾‘ï¼ˆAndroid/Chromeï¼‰
    let deferredPrompt;
    const installButton = document.getElementById('installButton');
    const androidInstallCard = document.getElementById('androidInstallCard');
    const installOverlay = document.getElementById('installOverlay');

    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('âœ… æ£€æµ‹åˆ°å¯ä»¥å®‰è£… PWA');

      // é˜»æ­¢é»˜è®¤çš„å®‰è£…æç¤º
      e.preventDefault();
      // ä¿å­˜äº‹ä»¶ä»¥ä¾¿åç»­è§¦å‘
      deferredPrompt = e;

      // å¦‚æœæ˜¯ Android ä¸”æ²¡æœ‰æ˜¾ç¤ºè¿‡å¼•å¯¼ï¼Œæ˜¾ç¤ºå¡ç‰‡å¼æç¤º
      if (isAndroid && !hasShownGuide) {
        setTimeout(() => {
          androidInstallCard.classList.remove('hidden');
          installOverlay.classList.remove('hidden');
        }, 2000);
      } else {
        // å…¶ä»–æƒ…å†µæ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®
        installButton.classList.remove('hidden');
      }
    });

    // å®‰è£…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    window.installApp = async () => {
      // éšè—æ‰€æœ‰æç¤º
      installButton.classList.add('hidden');
      androidInstallCard.classList.add('hidden');
      installOverlay.classList.add('hidden');

      if (deferredPrompt) {
        // æ˜¾ç¤ºå®‰è£…æç¤º
        deferredPrompt.prompt();
        // ç­‰å¾…ç”¨æˆ·å“åº”
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`ç”¨æˆ·${outcome === 'accepted' ? 'âœ… æ¥å—' : 'âŒ æ‹’ç»'}äº†å®‰è£…`);

        // æ¸…é™¤ deferredPrompt
        deferredPrompt = null;
      } else {
        // å¦‚æœæ²¡æœ‰ deferredPromptï¼Œå¯èƒ½æ˜¯ iOS æˆ–å…¶ä»–ä¸æ”¯æŒ PWA çš„æµè§ˆå™¨
        if (isIOS) {
          // iOS æ˜¾ç¤ºå¼•å¯¼
          document.getElementById('iosInstallGuide').classList.remove('hidden');
        } else {
          // å…¶ä»–æµè§ˆå™¨æç¤º
          vant.showToast({
            message: 'è¯·ä½¿ç”¨æµè§ˆå™¨èœå•ä¸­çš„"æ·»åŠ åˆ°ä¸»å±å¹•"åŠŸèƒ½',
            icon: 'info-o',
            duration: 3000
          });
        }
      }
    };

    // æ£€æµ‹åº”ç”¨æ˜¯å¦å·²å®‰è£…
    window.addEventListener('appinstalled', () => {
      // åº”ç”¨å·²å®‰è£…ï¼Œéšè—æ‰€æœ‰å®‰è£…æç¤º
      installButton.classList.add('hidden');
      androidInstallCard.classList.add('hidden');
      installOverlay.classList.add('hidden');
      document.getElementById('iosInstallGuide').classList.add('hidden');

      console.log('ğŸ‰ PWA å·²å®‰è£…');

      // æ¸…é™¤å¼•å¯¼æ ‡è®°ï¼Œå…è®¸å†æ¬¡æ˜¾ç¤ºï¼ˆå¦‚æœç”¨æˆ·å¸è½½åé‡è£…ï¼‰
      localStorage.removeItem(guideStorageKey);

      vant.showToast({
        message: 'âœ… å®‰è£…æˆåŠŸï¼',
        icon: 'success',
        duration: 2000
      });
    });

    // é¡µé¢åŠ è½½åæ£€æŸ¥æ˜¯å¦å¯ä»¥å®‰è£…
    window.addEventListener('load', () => {
      // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹è¿è¡Œï¼ˆå·²å®‰è£…ï¼‰
      if (isStandalone) {
        console.log('âœ… åº”ç”¨æ­£åœ¨ä»¥ç‹¬ç«‹æ¨¡å¼è¿è¡Œï¼ˆå·²å®‰è£…ï¼‰');
      } else {
        console.log('ğŸ“± åº”ç”¨æœªå®‰è£…');
        if (isIOS) {
          console.log('ğŸ æ£€æµ‹åˆ° iOS è®¾å¤‡ï¼Œå°†æ˜¾ç¤º iOS å®‰è£…å¼•å¯¼');
        } else if (isAndroid) {
          console.log('ğŸ¤– æ£€æµ‹åˆ° Android è®¾å¤‡ï¼Œç­‰å¾… beforeinstallprompt äº‹ä»¶');
        } else {
          console.log('ğŸ’» æ£€æµ‹åˆ°æ¡Œé¢è®¾å¤‡');
        }
      }

      // æ¯æ¬¡è®¿é—®æ—¶æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºå¼•å¯¼ï¼ˆå¦‚æœä¹‹å‰æ‹’ç»è¿‡ï¼Œå¯ä»¥è®¾ç½®ä¸º 7 å¤©åå†æ¬¡æç¤ºï¼‰
      const lastShown = localStorage.getItem(guideStorageKey);
      if (lastShown) {
        const daysSinceShown = (Date.now() - parseInt(lastShown)) / (1000 * 60 * 60 * 24);
        if (daysSinceShown > 7) {
          // 7 å¤©åæ¸…é™¤æ ‡è®°ï¼Œå¯ä»¥å†æ¬¡æç¤º
          localStorage.removeItem(guideStorageKey);
        }
      }

      // æ˜¾ç¤ºå½“å‰é¡µé¢ URL
      const pageUrlElement = document.getElementById('pageUrl');

      if (pageUrlElement) {
        const currentUrl = window.location.href;
        pageUrlElement.textContent = currentUrl;
        console.log('ğŸ”— å½“å‰é¡µé¢åœ°å€:', currentUrl);
      }
    });

    // åˆ·æ–°é¡µé¢åŠŸèƒ½ï¼ˆæ·»åŠ æ—¶é—´å‚æ•°é¿å…ç¼“å­˜ï¼‰
    window.refreshPage = function() {
      const url = new URL(window.location.href);
      // æ·»åŠ æˆ–æ›´æ–°æ—¶é—´æˆ³å‚æ•°
      url.searchParams.set('t', Date.now());
      // è·³è½¬åˆ°æ–° URL
      window.location.href = url.toString();
    };

    // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œå¦‚æœç”¨æˆ·ä»æ¡Œé¢å›¾æ ‡æ‰“å¼€ï¼Œè®°å½•ä¸‹æ¥
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        // é¡µé¢è¢«éšè—
        localStorage.setItem('lastVisit', Date.now().toString());
      }
    });

    // ========== æ³¨å†Œ Service Worker (PWA) ==========
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(registration => {
          console.log('âœ… ServiceWorker æ³¨å†ŒæˆåŠŸ:', registration.scope);
        })
        .catch(error => {
          console.log('âŒ ServiceWorker æ³¨å†Œå¤±è´¥:', error);
        });
    }
  </script>
</body>
</html>
